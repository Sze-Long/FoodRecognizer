{% extends 'base.html' %}

{% block head %}
  <title>Image History</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
  <style>
    .main-image { text-align: center; margin-top: 2rem; }
    .main-image img { max-width: 90%; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    .thumbnails { display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem; margin-top: 2rem; }
    .thumbnails form { display: inline-block; }
    .thumbnails img { width: 120px; border-radius: 8px; cursor: pointer; transition: transform 0.2s ease; }
    .thumbnails img:hover { transform: scale(1.05); }
    .nutrition-info { max-width: 700px; margin: 2rem auto; }
    .nutrition-info ul { list-style: none; padding: 0; }
    .nutrition-info li { background: #f0f0f0; padding: 12px; margin-bottom: 10px; border-radius: 6px; }
    .date-picker { text-align: center; margin-top: 2rem; }
    .date-picker input { padding: 0.5rem 1rem; font-size: 1rem; }
  </style>
{% endblock %}

{% block body %}
    <div class="navigation">
        <a href="{{ url_for('index') }}" class="nav-button">Home</a>
    </div>

    <div class="header">
        <h1>History</h1>
        <h2><i>Browse your food scans by date</i></h2>
    </div>

    <div class="date-picker">
        <form method="POST">
        <input type="date" name="date" value="{{ selected_date }}" max="{{ selected_date }}" onchange="this.form.submit()">
        </form>
    </div>

    {% if image %}
        <div class="main-image">
        <img src="{{ url_for('static', filename=image) }}" alt="Selected Image">
        </div>

        <div class="nutrition-info">
        <h3>Nutrition Facts</h3>
        <ul>
            {% for entry in grid %}
            {% if entry.image_name == image %}
                {% for n in entry.nutrient_grid %}
                <li><strong>{{ n[0] }}</strong>: {{ n[1] | round(1) }} {{ n[2] }}</li>
                {% endfor %}
            {% endif %}
            {% endfor %}
        </ul>
        </div>
    {% else %}
        <p style="text-align: center; margin-top: 3rem;">No images found for this date.</p>
    {% endif %}

    {% if grid|length > 1 %}
        <div class="thumbnails">
        {% for entry in grid %}
            <form method="POST">
            <input type="hidden" name="date" value="{{ selected_date }}">
            <input type="hidden" name="image_path" value="{{ entry.image_name }}">
            <button type="submit" style="all: unset;">
                <img src="{{ url_for('static', filename=entry.image_name) }}" alt="Thumbnail">
            </button>
            </form>
        {% endfor %}
        </div>
    {% endif %}
{% endblock %}
